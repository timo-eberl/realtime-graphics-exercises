[gd_scene load_steps=13 format=4 uid="uid://wvh63jwvhrqx"]

[ext_resource type="Material" uid="uid://bs8kdyjphctop" path="res://materials/gem_aged_layer.tres" id="1_efmii"]
[ext_resource type="Script" path="res://src/gem.gd" id="1_kpeyj"]
[ext_resource type="Texture2D" uid="uid://bhw64eq7rap6w" path="res://hdri_sepulchral_chapel_basement/sepulchral_chapel_basement_4k.hdr" id="3_p4hya"]

[sub_resource type="ArrayMesh" id="ArrayMesh_sj5ku"]
_surfaces = [{
"aabb": AABB(-0.490393, -0.490393, -0.25, 0.980785, 0.980785, 0.5),
"format": 34359742471,
"index_count": 288,
"index_data": PackedByteArray("AAABAAIAAgABAAMABAAFAAYABwAIAAkACAAKAAkACwAMAA0ADgAPABAAEAAPABEABAASAAUAEwAUABUAFAAWABUAFwAYABkAGgAbABwAHQAeAB8ABAAgABIAIQAiACMAJAAlACYAFwAZACcAKAApACoAKgApACsABAAsACAALQAuAC8ALgAwAC8AFwAnADEAMgAzADQANQA2ADcABAA4ACwAOQA6ADsAOgA8ADsAPQA+AD8AQABBAEIAQgBBAEMABABEADgARQBGAEcARgBIAEcAFwBJAEoASwBMAE0ATgBPAFAABABRAEQAUgBTAFQAVQBWAFcAFwBKAFgAWQBaAFsAWwBaAFwABABdAFEAXgBfAGAAXwBhAGAAFwBYAGIAYwBkAGUAZQBkAGYAZwBoAGkAagBrAGwAawBtAGwAFwBiAG4AbwBwAHEAcQBwAHIABABzAHQAdQB2AHcAdgB4AHcAFwBuAHkAegB7AHwAfQB+AH8ABACAAHMAgQCCAIMAhACFAIYAFwB5AIcAiACJAIoAigCJAIsABACMAIAAjQCOAI8AjgCQAI8AFwCHAJEAkgCTAJQAlACTAJUAlgCXAJgAmQCaAJsAnACdAJ4AFwCRAJ8AoAChAKIAogChAKMABACkAKUApgCnAKgApwCpAKgAFwCfAKoAqwCsAK0ArgCvALAABACxAKQAsgCzALQAtQC2ALcAFwCqALgAuQC6ALsAuwC6ALwABAAGALEAvQC+AL8AvgDAAL8AFwC4AMEA"),
"primitive": 3,
"uv_scale": Vector4(0, 0, 0, 0),
"vertex_count": 194,
"vertex_data": PackedByteArray("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uCIPlDjKuOm4Ig+UOMq46bgiD5T//////38AgP9/ocNmUAmt/3+hw2ZQCa3/f6HDZlAJrf9/ocNmUAmt/3+hw2ZQCa3/f6HDZlAJrf9//3//fwCAXLz//+olzJdcvP//6iXMl1y8///qJcyXXLz//+olzJf//////38AgP//////fwCA//////9/AIC5acW1HGcLpLlpxbUcZwukuWnFtRxnC6S5acW1HGcLpP9//3//fwCAxjW46bEwS5nGNbjpsTBLmcY1uOmxMEuZxjW46bEwS5n//////38AgP//////fwCAwlg8p46GkZ/CWDynjoaRn8JYPKeOhpGfwlg8p46GkZ/CWDynjoaRn8JYPKeOhpGf/3//f/9/AIA8J8LY20BJnDwnwtjbQEmcPCfC2NtASZw8J8LY20BJnDwnwtjbQEmcPCfC2NtASZz//////38AgDlKRZa1nKanOUpFlrWcpqc5SkWWtZympzlKRZa1nKan/3//f/9/AIBGFjjKy1ALpEYWOMrLUAukRhY4ystQC6RGFjjKy1ALpP//////fwCAXTz/f3uqCa1dPP9/e6oJrV08/397qgmtXTz/f3uqCa3/f/9//38AgP9//3//fwCA/3//f/9/AIAAAFy8g1UJrQAAXLyDVQmtAABcvINVCa0AAFy8g1UJrf//////fwCAOUq5aSW1oq45SrlpJbWirjlKuWkltaKuOUq5aSW1oq7/f/9//38AgP9//3//fwCARhbGNVxQIbVGFsY1XFAhtUYWxjVcUCG1RhbGNVxQIbX//////38AgMJYwlgPvAOPwljCWA+8A4/CWMJYD7wDj8JYwlgPvAOPwljCWA+8A4/CWMJYD7wDj/9//3//fwCAPCc8J2pHlLg8JzwnakeUuDwnPCdqR5S4PCc8J2pHlLg8JzwnakeUuDwnPCdqR5S4//////9/AIC5aTlKuCIPlLlpOUq4Ig+UuWk5SrgiD5S5aTlKuCIPlP9//3//fwCAxjVGFl5FIbXGNUYWXkUhtcY1RhZeRSG1xjVGFl5FIbX//////38AgP9/XTzqJcyX/39dPOolzJf/f1086iXMl/9/XTzqJcyX/3//f/9/AID/f/9//38AgP9//3//fwCAXLwAAGZQCa1cvAAAZlAJrVy8AABmUAmtXLwAAGZQCa1cvAAAZlAJrVy8AABmUAmt//////9/AIBFljlKsTBLmUWWOUqxMEuZRZY5SrEwS5lFljlKsTBLmf9//3//fwCA/3//f/9/AIA4ykYWHGcLpDjKRhYcZwukOMpGFhxnC6Q4ykYWHGcLpP//////fwCAPKfCWNtASZw8p8JY20BJnDynwljbQEmcPKfCWNtASZw8p8JY20BJnDynwljbQEmc/3//f/9/AIDC2DwnjoaRn8LYPCeOhpGfwtg8J46GkZ/C2DwnjoaRn8LYPCeOhpGfwtg8J46GkZ///////38AgMW1uWnLUAukxbW5actQC6TFtblpy1ALpMW1uWnLUAukuOnGNbWcpqe46cY1tZymp7jpxjW1nKanuOnGNbWcpqf//////38AgA==")
}]

[sub_resource type="PanoramaSkyMaterial" id="PanoramaSkyMaterial_003o4"]
panorama = ExtResource("3_p4hya")

[sub_resource type="Sky" id="Sky_yap15"]
sky_material = SubResource("PanoramaSkyMaterial_003o4")

[sub_resource type="Environment" id="Environment_aysn2"]
background_mode = 2
sky = SubResource("Sky_yap15")
tonemap_mode = 1
tonemap_exposure = 4.0
tonemap_white = 16.0
glow_enabled = true
glow_intensity = 0.4

[sub_resource type="Shader" id="Shader_wnhr8"]
code = "// NOTE: Shader automatically converted from Godot Engine 4.3.stable's StandardMaterial3D.

shader_type spatial;
render_mode blend_mix, depth_draw_opaque, cull_back, diffuse_burley, specular_schlick_ggx;

uniform vec4 albedo : source_color;
uniform sampler2D texture_albedo : source_color, filter_linear_mipmap, repeat_enable;
uniform float point_size : hint_range(0.1, 128.0, 0.1);

uniform float roughness : hint_range(0.0, 1.0);
uniform sampler2D texture_metallic : hint_default_white, filter_linear_mipmap, repeat_enable;
uniform vec4 metallic_texture_channel;
uniform sampler2D texture_roughness : hint_roughness_r, filter_linear_mipmap, repeat_enable;

uniform float specular : hint_range(0.0, 1.0, 0.01);
uniform float metallic : hint_range(0.0, 1.0, 0.01);
varying vec3 uv1_triplanar_pos;

uniform float uv1_blend_sharpness : hint_range(0.0, 150.0, 0.001);
varying vec3 uv1_power_normal;

uniform vec3 uv1_scale;
uniform vec3 uv1_offset;
uniform vec3 uv2_scale;
uniform vec3 uv2_offset;

void vertex() {
	vec3 normal = NORMAL;

	TANGENT = vec3(0.0, 0.0, -1.0) * abs(normal.x);
	TANGENT += vec3(1.0, 0.0, 0.0) * abs(normal.y);
	TANGENT += vec3(1.0, 0.0, 0.0) * abs(normal.z);
	TANGENT = normalize(TANGENT);

	BINORMAL = vec3(0.0, 1.0, 0.0) * abs(normal.x);
	BINORMAL += vec3(0.0, 0.0, -1.0) * abs(normal.y);
	BINORMAL += vec3(0.0, 1.0, 0.0) * abs(normal.z);
	BINORMAL = normalize(BINORMAL);

	// UV1 Triplanar: Enabled
	uv1_power_normal = pow(abs(NORMAL), vec3(uv1_blend_sharpness));
	uv1_triplanar_pos = VERTEX * uv1_scale + uv1_offset;
	uv1_power_normal /= dot(uv1_power_normal, vec3(1.0));
	uv1_triplanar_pos *= vec3(1.0, -1.0, 1.0);
}

vec4 triplanar_texture(sampler2D p_sampler, vec3 p_weights, vec3 p_triplanar_pos) {
	vec4 samp = vec4(0.0);
	samp += texture(p_sampler, p_triplanar_pos.xy) * p_weights.z;
	samp += texture(p_sampler, p_triplanar_pos.xz) * p_weights.y;
	samp += texture(p_sampler, p_triplanar_pos.zy * vec2(-1.0, 1.0)) * p_weights.x;
	return samp;
}

void fragment() {
	vec4 albedo_tex = triplanar_texture(texture_albedo, uv1_power_normal, uv1_triplanar_pos);
	ALBEDO = albedo.rgb * albedo_tex.rgb;

	float metallic_tex = dot(triplanar_texture(texture_metallic, uv1_power_normal, uv1_triplanar_pos), metallic_texture_channel);
	METALLIC = metallic_tex * metallic;
	SPECULAR = specular;

	vec4 roughness_texture_channel = vec4(1.0, 0.0, 0.0, 0.0);
	float roughness_tex = dot(triplanar_texture(texture_roughness, uv1_power_normal, uv1_triplanar_pos), roughness_texture_channel);
	ROUGHNESS = roughness_tex * roughness;
}
"

[sub_resource type="FastNoiseLite" id="FastNoiseLite_64hcn"]

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_68swt"]
seamless = true
noise = SubResource("FastNoiseLite_64hcn")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_eudt4"]
render_priority = 0
shader = SubResource("Shader_wnhr8")
shader_parameter/albedo = Color(1, 1, 1, 1)
shader_parameter/point_size = 1.0
shader_parameter/roughness = 1.0
shader_parameter/metallic_texture_channel = null
shader_parameter/specular = 0.5
shader_parameter/metallic = 0.0
shader_parameter/uv1_blend_sharpness = 1.0
shader_parameter/uv1_scale = Vector3(1, 1, 1)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/uv2_scale = Vector3(1, 1, 1)
shader_parameter/uv2_offset = Vector3(0, 0, 0)
shader_parameter/texture_albedo = SubResource("NoiseTexture2D_68swt")

[sub_resource type="SphereMesh" id="SphereMesh_ow3lk"]

[node name="Gem" type="MeshInstance3D"]
transform = Transform3D(-6.55671e-09, 0, 0.095, 0, 0.19, 0, -0.15, 0, -4.15258e-09, 0, 0, 0)
material_override = ExtResource("1_efmii")
mesh = SubResource("ArrayMesh_sj5ku")
script = ExtResource("1_kpeyj")
segments = 16
center_size = 0.545

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_aysn2")

[node name="DirectionalLight" type="DirectionalLight3D" parent="."]
transform = Transform3D(-2.70784e-07, 6.66667, 2.37568e-07, -3.88967, -3.15602e-07, 4.89065, 9.78129, 3.55605e-07, 1.94484, 0, 52.6316, 0)
light_color = Color(0.61, 0.7855, 1, 1)
light_energy = 0.05
shadow_enabled = true
shadow_opacity = 0.35
directional_shadow_split_1 = 0.025
directional_shadow_split_2 = 0.05
directional_shadow_split_3 = 0.125

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 1.77636e-15, 0, 1, 0, 0, 0, 1, -1.62162, 0, -1.11921e-07)
material_override = SubResource("ShaderMaterial_eudt4")
mesh = SubResource("SphereMesh_ow3lk")
